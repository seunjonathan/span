{
	"name": "Towworksv2 Transient Views",
	"properties": {
		"content": {
			"query": "-- Create database if it does not exist\nIF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'silver')\nBEGIN\n    CREATE DATABASE [silver]\nEND\nGO\n\nUSE silver\nGO\n\n-- Create schema if it does not exist\nIF NOT EXISTS (SELECT * FROM sys.schemas WHERE name = 'towworks')\nBEGIN\n    -- Create Schema has to be the first statement to work - so we wrap it in EXEC\n    EXEC ('CREATE SCHEMA towworks;');\nEND\nGO\n\n-- Create file format if it does not exist\nIF NOT EXISTS (SELECT * FROM sys.external_file_formats WHERE name = 'ParquetFormat')\nBEGIN\n    CREATE EXTERNAL FILE FORMAT ParquetFormat WITH ( FORMAT_TYPE = PARQUET );\nEND\nGO\n\n-- DROP EXTERNAL DATA SOURCE ParquetStorage\nIF NOT EXISTS (SELECT * FROM sys.external_data_sources WHERE name = 'ParquetStorage')\nBEGIN\n    CREATE EXTERNAL DATA SOURCE ParquetStorage  \n    WITH (\n        LOCATION = 'abfss://transient@adlssmgdev.dfs.core.windows.net'\n    )\nEND\nGO\n\n-- DROP VIEW [towworks].[vw_transient_FACT_EVENTS] \nCREATE OR ALTER VIEW [towworks].[vw_transient_FACT_EVENTS] AS\n    SELECT         \n        ([Event.EventGuid] ) AS EventGuid,\n        ([Event.CustomerGuid] ) AS CustomerGuid,\n        ([Event.BillingCompanyGuid] ) AS BillingCompanyGuid,\n        ([Event.Action] ) AS Action,\n        ([Event.ByAssetGuid] ) AS ByAssetGuid,\n        ([Event.ByAssetName] ) AS ByAssetName,\n        ([Event.ToAssetGuid] ) AS ToAssetGuid,\n        ([Event.ToAssetName] ) AS ToAssetName,\n        ([Event.FromLocationGuid] ) AS FromLocationGuid,\n        ([Event.FromLocation] ) AS FromLocation,\n        ([Event.FromLocationShortName] ) AS FromLocationShortName,\n        ([Event.FromLocationPortName] ) AS FromLocationPortName,\n        ([Event.FromZone] ) AS FromZone,\n        ([Event.FromParentArea] ) AS FromParentArea,\n        ([Event.ToLocation] ) AS ToLocation,\n        ([Event.ToLocationShortName] ) AS ToLocationShortName,\n        ([Event.ToLocationPortName] ) AS ToLocationPortName,\n        ([Event.ToZone] ) AS ToZone,\n        ([Event.ToParentArea] ) AS ToParentArea,\n        ([Event.ToWaterwayGuid] ) AS ToWaterwayGuid,\n        ([Event.ToWaterWayName] ) AS ToWaterWayName,\n        ([Event.ToWaterWayMile] ) AS ToWaterWayMile,\n        ([Event.LoadStatus] ) AS LoadStatus,\n        ([Event.CargoName]) AS CargoName,\n        ([Event.CustomerName] ) AS CustomerName,\n        ([Event.ContractNumber] ) AS ContractNumber,\n        ([Event.LogisticsOrderGuid] ) AS LogisticsOrderGuid,\n        ([Event.LogisticsOrderLineGuid] ) AS LogisticsOrderLineGuid,\n        ([Event.LinkedTaskGuid]) AS LinkedTaskGuid,\n        ([Event.LinkedWorkOrderGuid]) AS LinkedWorkOrderGuid,\n        ([Event.LinkedEventGuid] ) AS LinkedEventGuid,\n        ([Event.OrderNumber] ) AS OrderNumber,\n        ([Event.OrderType] ) AS OrderType,\n        ([Event.TowOrderNumber]   ) AS TowOrderNumber,\n        ([Event.WorkOrderNumber] ) AS WorkOrderNumber,\n        ([Event.WORKORDERGUID] ) AS WORKORDERGUID,\n        ([Event.WorkOrderType] ) AS WorkOrderType,\n        ([Event.TaskType] ) AS TaskType,\n        ([Event.Direction]) AS Direction,\n        ([Event.FuelOnBoard]) AS FuelOnBoard,\n        ([Event.FuelUsed]) AS FuelUsed,\n        ([Event.FuelPurchased]) AS FuelPurchased,\n        ([Event.LubeOnBoard]) AS LubeOnBoard,\n        ([Event.LubeUsed]) AS LubeUsed,\n        ([Event.LubePurchased]) AS LubePurchased,\n        ([Event.SlopOil]) AS SlopOil,\n        ([Event.GearOil]) AS GearOil,\n        ([Event.OilyWater]) AS OilyWater,\n        ([Event.RateSchedule]) AS RateSchedule,\n        ([Event.FleetSchedule]) AS FleetSchedule,\n        ([Event.ByVendorGuid]) AS ByVendorGuid,\n        ([Event.ByVendorName]) AS ByVendorName,\n        ([Event.QuotedRate]) AS QuotedRate,\n        ([Event.IsOpenEndedEvent]) AS IsOpenEndedEvent,\n        ([Event.WillCreateEventTypeGuid]) AS WillCreateEventTypeGuid,\n        ([Event.WillCreateEventTypeName] ) AS WillCreateEventTypeName,\n        ([Event.TransactionsExpected] ) AS TransactionsExpected,\n        ([Event.CreatedBy]) AS CreatedBy,\n        ([Event.ToLcationGuid]) AS ToLcationGuid,\n        ([Event.FromWaterwayGuid]) AS FromWaterwayGuid,\n        ([Event.FromWaterWay]) AS FromWaterWay,\n        ([Event.FromWaterWayMile]) AS FromWaterWayMile,\n        ([Event.LastChangedBy]) AS LastChangedBy,\n        CAST(NULL AS bit) AS marked_as_deleted,\n        CAST([Event.StartTime] AS datetime2) AS StartTime,\n        CAST([Event.EndTime] AS datetime2) AS EndTime,\n        CAST([Event.LastChangedDate] AS datetime2) AS LastChangedDate,\n        CAST([Event.CreatedDate] AS datetime2) AS CreatedDate,\n        TRY_CAST([Event.BillableHours] AS FLOAT) AS BillableHours,\n        TRY_CAST([Event.BillableQuantity] AS FLOAT) AS BillableQuantity,\n        TRY_CAST([Event.CostHours] AS FLOAT) AS CostHours,\n        TRY_CAST([Event.CargoEventQuantity] AS FLOAT) AS CargoEventQuantity,\n        TRY_CAST([Event.CargoQuantity] AS FLOAT) AS CargoQuantity,\n        TRY_CAST([Event.OrderLineNumber] AS BIGINT) AS OrderLineNumber,\n        TRY_CAST([Event.TowOrderLineNumber] AS INT) AS TowOrderLineNumber\nFROM\n    OPENROWSET(\n            BULK 'silver/TOWWORKS/EVENTS',\n            DATA_SOURCE = 'ParquetStorage',\n            FORMAT='PARQUET'\n            ) AS [result]\nGO\n\n\n-- DROP VIEW [towworks].[vw_transient_FACT_WORKORDERS]\nCREATE OR ALTER VIEW [towworks].[vw_transient_FACT_WORKORDERS] AS\nSELECT\n    ACKNOWLEDGEDBY,\n    WORKTOLOCATIONGUID,\n    WORKTOLOCATIONPORTNAME,\n    WORKTOWATERWAYGUID,\n    WORKWATERWAYGUID,\n    WORKORDERNUMBERSORT,\n    WORKORDERSTATUSDESCRIPTION,\n    WORKORDERSTATUSGUID,\n    WORKORDERSTATUSNAME,\n    WORKORDERTYPEGUID,\n    WORKORDERTYPENAME,\n    WORKLOCATIONPORTNAME,\n    WORKORDERDESCRIPTION,\n    WORKORDERGUID,\n    WORKORDERINSTRUCTIONS,\n    WORKORDERNOTES,\n    WORKORDERNUMBER,\n    TOASSETGUID,\n    TOASSETNAME,\n    VENDORGUID,\n    VENDORNAME,\n    WORKLOCATIONGUID,\n    WORKLOCATIONNAME,\n    SAFETYINSTRUCTIONS,\n    TANKERMANALLOWANCEUOM,\n    TERMSPAYMENT,\n    TERTIARYASSETGUID,\n    TERTIARYASSETNAME,\n    RESPONSIBLEPARTYGUID,\n    RESPONSIBLEPARTYNAME,\n    RESPONSIBLEPARTYTYPE,\n    RESPONSIBLEPERSONGUID,\n    PURCHASEORDERLINE,\n    PURCHASEORDERLINEGUID,\n    PURCHASEORDERNUMBER,\n    RATESCHEDULE,\n    REQUESTEDBY,\n    OUTAGE,\n    PARENTWORKORDERGUID,\n    PRIORITYTYPEGUID,\n    PRIORITYTYPENAME,\n    PURCHASEORDERGUID,\n    LIMITGUID,\n    LINKEDISSUEGUID,\n    LINKEDLOGISTICSLINEGUID,\n    LOCATIONINSTRUCTIONS,\n    ORDERTAKENBY,\n    HASOPENTASKS,\n    INNAGE,\n    LASTCHANGEDBY,\n    LATECOMPLETION,\n    LATESTART,\n    EXTERNALREFERENCE,\n    FIRMJOB,\n    GLACCOUNT,\n    HASOPENISSUES,\n    EARLYSTART,\n    EQUIPMENTINSTRUCTIONS,\n    EQUIPMENTPREPCOMPLETE,\n    EQUIPMENTPREPREQUIRED,\n    CONSIGNEDTOGUID_NAME,\n    CONTRACTGUID,\n    COSTCENTER,\n    CREATEDBY,\n    EARLYCOMPLETION,\n    BYASSETNAME,\n    CARGOINSTRUCTIONS,\n    COMMERCIALAPPROVAL,\n    COMMODITYOWNERGUID,\n    COMMODITYOWNERGUID_NAME,\n    CONSIGNEDTOGUID,\n    AGENCYNAME,\n    BILLINGCOMPANYGUID,\n    BILLINGCOMPANYNAME,\n    BILLTOCUSTOMERGUID,\n    BILLTOCUSTOMERNAME,\n    BYASSETGUID,\n    CAST(NULL AS bigint) AS marked_as_deleted,\n    CAST(CREATEDDATE AS datetime2) AS CREATEDDATE,\n    CAST(LASTCHANGEDDATE AS datetime2) AS LASTCHANGEDDATE,\n    TRY_CAST([ACKNOWLEDGEDDATE] AS DATETIME2) AS ACKNOWLEDGEDDATE,\n    TRY_CAST([REQUESTEDSTARTDATE] AS DATETIME2) AS REQUESTEDSTARTDATE,\n    TRY_CAST([REQUESTEDCOMPLETIONDATE] AS DATETIME2) AS REQUESTEDCOMPLETIONDATE,\n    TRY_CAST([ESTIMATEDSTARTDATE] AS DATETIME2) AS ESTIMATEDSTARTDATE,\n    TRY_CAST([ESTIMATEDCOMPLETIONDATE] AS DATETIME2) AS ESTIMATEDCOMPLETIONDATE,\n    TRY_CAST([ACTUALSTARTDATE] AS DATETIME2) AS ACTUALSTARTDATE,\n    TRY_CAST([ACTUALCOMPLETIONDATE] AS DATETIME2) AS ACTUALCOMPLETIONDATE,\n    TRY_CAST([ORDERTAKENDATE] AS DATETIME2) AS ORDERTAKENDATE,\n    TRY_CAST([REQUESTEDDATE] AS DATETIME2) AS REQUESTEDDATE,\n    TRY_CAST(WORKWATERWAYMILE AS FLOAT) AS WORKWATERWAYMILE,\n    TRY_CAST(WORKTOWATERWAYMILE AS FLOAT) AS WORKTOWATERWAYMILE,\n    TRY_CAST(ESTIMATEDCOST AS FLOAT) AS ESTIMATEDCOST,\n    TRY_CAST(ACTUALCOST AS FLOAT) AS ACTUALCOST,\n    TRY_CAST(ESTIMATEDREVENUE AS FLOAT) AS ESTIMATEDREVENUE,\n    TRY_CAST(ACTUALREVENUE AS FLOAT) AS ACTUALREVENUE,\n    TRY_CAST(MAXALLOWABLEDRAFT AS FLOAT) AS MAXALLOWABLEDRAFT,\n    TRY_CAST(TANKERMANALLOWANCE AS FLOAT) AS TANKERMANALLOWANCE\nFROM\n    OPENROWSET(\n            BULK 'silver/TOWWORKS/WORKORDERS',\n            DATA_SOURCE = 'ParquetStorage',\n            FORMAT='PARQUET'\n    ) AS [result]\nGO\n\n\n-- DROP VIEW [towworks].[vw_transient_FACT_TRIPS]\nCREATE OR ALTER VIEW [towworks].[vw_transient_FACT_TRIPS] AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n            BULK 'silver/TOWWORKS/TRIPS',\n            DATA_SOURCE = 'ParquetStorage',\n            FORMAT='PARQUET'\n    ) AS t\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "silver",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}