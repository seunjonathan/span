{
	"name": "Create  TOPS NearRealTime Views",
	"properties": {
		"description": "Union Fast n Batch Views",
		"content": {
			"query": "-- Creating a UNION of Fast Track and Batch View to generate NearRealtime BOL view\nCREATE OR ALTER VIEW [tops].[vw_NearRealTime_BOL] AS\n    SELECT\n        [BOL_Number]\n        ,[Sailing_ID]\n        ,[Container_Type]\n        ,[Assignment_Status]\n        ,[Hazardous_Goods]\n        ,[Trailer_Length]\n        ,[Trailer_Overhang_Front]\n        ,[Trailer_Overhang_Back]\n        ,[Signature_Date_Time]\n        ,CAST([Signature_Date_Time] AS DATE) AS [Signature_Date]\n        ,CAST([Signature_Date_Time] AS TIME) AS [Signature_Time]\n        ,[Actual_Picked_Up_Date_Time]\n        ,CAST([Actual_Picked_Up_Date_Time] AS DATE) AS [Actual_Picked_Up_Date]\n        ,CAST([Actual_Picked_Up_Date_Time] AS TIME) AS [Actual_Picked_Up_Time]\n        ,[Route]\n        ,[Added_Date]\n        ,[Preferred_Pickup_Date_Time_official]\n        ,CAST([Preferred_Pickup_Date_Time_official] AS DATE) AS [Preferred_Pickup_Date_official]\n        ,CAST([Preferred_Pickup_Date_Time_official] AS TIME) AS [Preferred_Pickup_Time_official]\n        ,[Preferred_Pickup_Date_Time]\n        ,CAST([Preferred_Pickup_Date_Time] AS DATE) AS [Preferred_Pickup_Date]\n        ,CAST([Preferred_Pickup_Date_Time] AS TIME) AS [Preferred_Pickup_Time]\n        ,[Deleted_Date]\n        ,[DG_Authorized]\n        ,[Status]\n        ,[pk_Job_in]\n        ,[fk_Customer_in]\n        ,[fk_MovementMode_in]\n        ,[Unit_Number]\n        ,[Reservation_used_TEU]\n        ,[Refresh_Time_UTC]\n    FROM (\n        select \n            *,\n            ROW_NUMBER () OVER (PARTITION BY BOL_Number ORDER BY Refresh_Time_UTC desc) as rn\n        from (\n            select * from gold.tops.vw_BOL\n            UNION\n            select * from silver.tops.vw_FastTrack_BOL\n        ) c\n    ) d\n    where rn = 1\nGO\n\n\n\n-- Creating a UNION of Fast Track and Batch View to generate NearRealtime Sailing view\nCREATE OR ALTER VIEW [tops].[vw_NearRealTime_SAILING] AS\n    SELECT\n            [Sailing_ID]\n            ,[Scheduled_Departure_Date_Time]\n            ,CAST ([Scheduled_Departure_Date_Time] AS DATE) AS [Scheduled_Departure_Date]\n            ,CAST ([Scheduled_Departure_Date_Time] AS TIME) AS [Scheduled_Departure_Time]\n            ,[Actual_Departure_Date_Time]\n            ,CAST ([Actual_Departure_Date_Time] AS DATE) AS [Actual_Departure_Date]        \n            ,CAST ([Actual_Departure_Date_Time] AS TIME) AS [Actual_Departure_Time]\n            ,[Departure_Variance]\n            ,[Scheduled_Arrival_Date_Time]\n            ,CAST ([Scheduled_Arrival_Date_Time] AS DATE) AS [Scheduled_Arrival_Date]\n            ,CAST ([Scheduled_Arrival_Date_Time] AS TIME) AS [Scheduled_Arrival_Time]\n            ,[Actual_Arrival_Date_Time]\n            ,CAST ([Actual_Arrival_Date_Time] AS DATE) AS [Actual_Arrival_Date]\n            ,CAST ([Actual_Arrival_Date_Time] AS TIME) AS [Actual_Arrival_Time]\n            ,[Arrival_Variance]\n            ,[Add_Date]\n            ,[Deleted_Date]\n            ,[Lock_Sailing]\n            ,[fk_Truck_in]\n            ,[fk_Route_in]\n            ,Refresh_Time_UTC\n    FROM (\n        select \n            *,\n            ROW_NUMBER () OVER (PARTITION BY Sailing_ID ORDER BY Refresh_Time_UTC desc) as rn\n        from (\n            select * from gold.tops.vw_Sailing\n            UNION\n            select * from silver.tops.vw_FastTrack_Sailing\n        ) c\n    ) d\n    where rn = 1\nGO\n\n-- Creating a UNION of NearRaltime Location View with some static data\nCREATE OR ALTER VIEW [tops].[vw_NearRealTime_LOCATION] AS\n    (          \n        (SELECT [pk_Truck_in], [Location_Type], [Vessel_Name], [Longitude], [Latitude], [Knots]\n        ,[Heading], [Date_Time] from silver.[tops].[vw_FastTrack_LOCATION])\n         UNION\n        (SELECT 100, 'Terminal', 'Tilbury', -123.0316925, 49.1419716, 0, 0, getdate())\n        UNION\n        (SELECT  101, 'Terminal', 'Surrey', -122.8982086, 49.1957245, 0, 0, getdate())\n        UNION\n        (SELECT  102, 'Terminal', 'Swartz Bay', -123.4071486, 48.6861706, 0, 0, getdate())\n        UNION\n        (SELECT  103, 'Terminal', 'Duke Point', -123.8774073, 49.1428458, 0, 0, getdate())\n    )\nGO\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "gold",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}